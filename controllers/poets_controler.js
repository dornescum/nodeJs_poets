let dummy_poets = [
	{
		"id": "1",
		"first_name": "aurel",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "2",
		"first_name": "ana",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "3",
		"first_name": "andrei",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "4",
		"first_name": "costel",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "5",
		"first_name": "costel",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "6",
		"first_name": "costin",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "7",
		"first_name": "dan",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "8",
		"first_name": "elena",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "9",
		"first_name": "george",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},
	{
		"id": "10",
		"first_name": "ionut",
		"second_name": "popescu",
		"desc": {
			"oras": "Bucuresti",
			"cartier": "Rahova"
		},
		"biography": {
			"year": {
				"1970": "first_book",
				"1971": "second_book",
				"1972": "third_book"
			}
		},
		"prison_time": {
			"year": {
				"1980": {
					"start_time": "1980",
					"realese_time": "1985",
					"accusation": "murder"
				},
				"1986": {
					"start_time": "1986",
					"release_time": "1990",
					"accusation": "theft"
				}
			}
		},
		"after_prison": {
			"sickness": {
				"disease": "migraine",
				"treatment": {
					"hospital": "nr_9",
					"doctors": {
						"first_doctor": {
							"first_name": "Ionut",
							"second_name": "Popescu",
							"branch": "General medicine"
						},
						"second_doctor": {
							"first_name": "Narian",
							"second_name": "Popescu",
							"branch": "General medicine"
						}
					}
				}
			}
		},
		"death": "1991"
	},


];

const Poet = require('../models/schema');


const getPoetsById = async (req, res, next) => {
	const poetId = req.params.id;
	let poet;
	try	{
		poet =await Poet.findById(poetId);
	} catch (err){
		const error = new Error('no poet found');
		error.code = 404;
		return next(error); // pt next(error) trebuie return!!!
	}

	// const poet = dummy_poets.find(p => {
	// 	return p.id === poetId;
	// });
	if(!poet){
		return res.status(404).json({message: 'no poet'});
	}
	// dc esti async folosesti next(error)
	// if (!poet) {
	// 	const error = new Error('no poet found');
	// 	error.code = 404;
	// 	// throw error;
	// 	return next(error); // pt next(error) trebuie return!!!
	// }

	// res.json({poet});
	res.json({poet: poet.toObject({getters: true}) }); //getters: true scap de _id =>id
};
const deletePoet = (req, res, next) => {
	const poetId = req.params.id;
	dummy_poets = dummy_poets.filter(p => p.id !== poetId);
	res.status(200).json({message: 'deleted poet'});

};
const createPoet = async (req, res, next) => {
	// const {first_name, second_name, id, prison_time, desc, biography, death} = req.body;
	// const createdPoet = {
	// 	first_name,
	// 	second_name,
	// 	id,
	// 	prison_time,
	// 	desc,
	// 	biography,
	// 	death
	// };
	// dummy_poets.push(createdPoet);


	const {first_name, second_name, image, description, biography, prison_time, death, after_prison} = req.body;
	const createdPoet = new Poet({
		first_name,
		second_name,
		image:"https://images.unsplash.com/photo-1579293676244-953f569610cd?ixid=MnwxMjA3fDB8MHxzZWFyY2h8NHx8cG9ldHxlbnwwfHwwfHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60",
		description,
		biography,
		prison_time,
		death,
		after_prison
	})
	try	{
		await createdPoet.save()
	} catch(err){
		console.log(err)
		return next(err)
	}

	res.status(201).json({poet: createdPoet});
};
const updatePoetById =async (req, res, next) => {
	const {first_name, second_name} = req.body;
	const poetId = req.params.id;
	let poet;
	try	{
		poet =await Poet.findById(poetId);
	} catch (err){
		const error = new Error('no poet found');
		error.code = 404;
		return next(error); // pt next(error) trebuie return!!!
	}
	poet.first_name = first_name;
	poet.second_name = second_name;
	try {
		await poet.save();
	}
	catch (err){
		const error = new Error('cannot update');
		error.code = 404;
		return next(error); // pt next(error) trebuie return!!!
	}

	res.status(200).json({poet: poet.toObject({getters: true})})

	// const updatedPoet ={...dummy_poets.find(p => p.id === poetId)};
	// const poetIndex = dummy_poets.findIndex(p => p.id === poetId);
	// updatedPoet.first_name = first_name;
	// updatedPoet.second_name = second_name;
	// dummy_poets[poetIndex] =updatedPoet;

};

// module.exports = getPoetsById;
// module.exports = deletePoet;

exports.getPoetsById = getPoetsById;
exports.deletePoet = deletePoet;
exports.createPoet = createPoet;
exports.updatePoetById = updatePoetById;



